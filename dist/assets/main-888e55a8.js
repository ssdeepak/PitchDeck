(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class b{services=new Map;instances=new Map;register(e,t,i=!0){this.services.set(e,{constructor:t,singleton:i,initialized:!1})}registerInstance(e,t){this.services.set(e,{instance:t,singleton:!0,initialized:!0}),this.instances.set(e,t)}get(e){const t=this.services.get(e);if(!t)throw new Error(`Service not registered: ${e}`);if(t.singleton&&t.instance)return t.instance;const i=this.instances.get(e);if(i)return i;if(!t.constructor)throw new Error(`Service constructor not available: ${e}`);const s=new t.constructor;return t.singleton&&(t.instance=s,this.instances.set(e,s)),s}has(e){return this.services.has(e)}async initializeAll(){const e=[];for(const[t,i]of this.services)if(!i.initialized){const s=this.initializeService(t);e.push(s)}await Promise.all(e)}async initializeService(e){const t=this.services.get(e);if(!(!t||t.initialized))try{const i=this.get(e);i.initialize&&await i.initialize(),t.initialized=!0}catch(i){throw console.error(`Failed to initialize service ${e}:`,i),i}}async destroyAll(){const e=[];for(const t of this.instances.values())if(t.destroy){const i=t.destroy();i instanceof Promise&&e.push(i)}await Promise.all(e),this.instances.clear();for(const t of this.services.values())t.initialized=!1,t.singleton&&(t.instance=void 0)}getRegisteredServices(){return Array.from(this.services.keys())}clear(){this.services.clear(),this.instances.clear()}}const c=new b,h={WINDOW_MANAGER:"WindowManager",DESKTOP_SERVICE:"DesktopService",AUTH_SERVICE:"AuthService",FILE_SERVICE:"FileService",COMPONENT_REGISTRY:"ComponentRegistry",COMPONENT_LOADER:"ComponentLoaderService",USER_CONFIG_SERVICE:"UserConfigService",THEME_SERVICE:"ThemeService",ANIMATION_SERVICE:"AnimationService"};class A{listeners=new Map;on(e,t){const i=e;this.listeners.has(i)||this.listeners.set(i,new Set),this.listeners.get(i).add(t)}off(e,t){const i=e,s=this.listeners.get(i);s&&(s.delete(t),s.size===0&&this.listeners.delete(i))}emit(e,...t){const i=e,s=this.listeners.get(i);if(s)for(const o of s)try{o(...t)}catch(n){console.error(`Error in event listener for ${i}:`,n)}}once(e,t){const i=(...s)=>{this.off(e,i),t(...s)};this.on(e,i)}listenerCount(e){const t=e;return this.listeners.get(t)?.size??0}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}eventNames(){return Array.from(this.listeners.keys())}}const a=new A;class z{name="WindowManager";windows=new Map;registry=new Map;nextZIndex=1e3;activeWindowId=null;saveConfigTimeout=null;saveConfigDebounceMs=1e3;async initialize(){console.log("Initializing Window Manager..."),this.registerDefaultWindows(),this.setupUserConfigIntegration(),console.log("Window Manager initialized")}registerDefaultWindows(){this.registerWindow("login",{defaultTitle:"Login",defaultSize:{width:400,height:300},defaultPosition:{x:100,y:100},minSize:{width:350,height:250},category:"authentication",isDocked:!1,isResizable:!0,isDraggable:!0}),this.registerWindow("register",{defaultTitle:"Create Account",defaultSize:{width:450,height:350},defaultPosition:{x:150,y:150},minSize:{width:400,height:300},category:"authentication",isDocked:!1,isResizable:!0,isDraggable:!0}),this.registerWindow("file-explorer",{defaultTitle:"File Explorer",defaultSize:{width:800,height:600},defaultPosition:{x:200,y:100},minSize:{width:400,height:300},category:"file-management",isDocked:!0,isResizable:!0,isDraggable:!0}),this.registerWindow("test-web-component",{defaultTitle:"Test Web Component",defaultSize:{width:500,height:400},defaultPosition:{x:250,y:150},minSize:{width:400,height:300},category:"development",isDocked:!1,isResizable:!0,isDraggable:!0}),this.registerWindow("todo-app",{defaultTitle:"Todo App",defaultSize:{width:700,height:800},defaultPosition:{x:300,y:100},minSize:{width:500,height:400},category:"productivity",isDocked:!1,isResizable:!0,isDraggable:!0}),console.log("Default windows registered")}registerWindow(e,t){this.registry.set(e,t)}async createWindow(e,t={}){if(this.windows.has(e))return console.warn(`Window with id '${e}' already exists`),this.windows.get(e);const i=this.registry.get(e);if(!i)throw new Error(`Window type '${e}' not registered`);const s=await this.getSavedWindowConfig(e),o={...i,...s&&{position:s.position,size:s.size,isMinimized:s.isMinimized,isFullscreen:s.isFullscreen,isTack:s.isTack,title:s.title||i.defaultTitle},...t},n={id:e,title:o.title??o.defaultTitle,component:o.component??void 0,componentInputs:o.componentInputs??void 0,position:o.position??o.defaultPosition??this.getDefaultPosition(),size:o.size??o.defaultSize,minSize:o.minSize,maxSize:o.maxSize??void 0,isActive:!1,isMinimized:o.isMinimized??!1,isFullscreen:o.isFullscreen??!1,isTack:o.isTack??!1,zIndex:this.nextZIndex++,isResizable:o.isResizable??!0,isDraggable:o.isDraggable??!0,category:o.category??void 0};return this.windows.set(e,n),await this.createWindowElement(n),this.activateWindow(e),a.emit("window:created",n),console.log(`Window '${e}' created with ${s?"saved":"default"} configuration`),n}async createWindowElement(e){const t=document.createElement("div");t.id=`window-${e.id}`,t.className="window",t.dataset.windowId=e.id,this.applyWindowStyles(t,e),this.createWindowStructure(t,e);const i=document.querySelector(".desktop-container");i?i.appendChild(t):console.error("Desktop container not found"),await this.loadWindowComponent(e)}async loadWindowComponent(e){try{const t=c.get(h.COMPONENT_LOADER);if(t.hasComponent(e.id)){const i=document.getElementById(`window-content-${e.id}`);if(!i){console.error(`Content container not found for window '${e.id}'`);return}const s=await t.loadComponent(e.id,i,e.componentInputs);s&&(await s.mount(),console.log(`Component loaded for window '${e.id}'`),e.componentInstance=s)}else console.log(`No component registered for window type '${e.id}'`)}catch(t){console.error(`Failed to load component for window '${e.id}':`,t)}}applyWindowStyles(e,t){const i=e.style;i.position="absolute",i.left=`${t.position.x}px`,i.top=`${t.position.y}px`,i.width=`${t.size.width}px`,i.height=`${t.size.height}px`,i.zIndex=t.zIndex.toString(),i.display=t.isMinimized?"none":"flex",e.classList.toggle("active",t.isActive),e.classList.toggle("fullscreen",t.isFullscreen),e.classList.toggle("minimized",t.isMinimized)}createWindowStructure(e,t){const i=document.createElement("div");i.className="window-titlebar";const s=document.createElement("div");s.className="window-controls macos-controls";const o=document.createElement("button");o.className="window-control close",o.addEventListener("click",()=>this.closeWindow(t.id)),s.appendChild(o);const n=document.createElement("button");n.className="window-control maximize",n.addEventListener("click",()=>this.toggleFullscreen(t.id)),s.appendChild(n),i.appendChild(s);const r=document.createElement("div");r.className="window-title",r.textContent=t.title,i.appendChild(r);const u=document.createElement("button");u.className="window-control tack",u.addEventListener("click",()=>this.toggleTack(t.id)),i.appendChild(u),e.appendChild(i);const l=document.createElement("div");l.className="window-content",l.id=`window-content-${t.id}`,e.appendChild(l),t.isResizable&&this.addResizeHandles(e,t),t.isDraggable&&this.addDragFunctionality(i,t)}addResizeHandles(e,t){const i=["n","e","s","w","ne","se","sw","nw"];for(const s of i){const o=document.createElement("div");o.className=`resize-handle resize-${s}`,o.addEventListener("mousedown",n=>this.startResize(n,t,s)),e.appendChild(o)}}addDragFunctionality(e,t){let i=!1,s={x:0,y:0},o={x:0,y:0};const n=l=>{t.isFullscreen||(i=!0,s={x:l.clientX,y:l.clientY},o={...t.position},this.activateWindow(t.id),l.preventDefault())},r=l=>{if(!i)return;const m=l.clientX-s.x,f=l.clientY-s.y,v={x:o.x+m,y:Math.max(0,o.y+f)};this.moveWindow(t.id,v)},u=()=>{i&&(i=!1,this.debouncedSaveWindowConfigurations())};e.addEventListener("mousedown",n),document.addEventListener("mousemove",r),document.addEventListener("mouseup",u),e.addEventListener("dblclick",()=>this.toggleFullscreen(t.id))}startResize(e,t,i){if(t.isFullscreen)return;let s=!0;const o=e.clientX,n=e.clientY,r={...t.size},u={...t.position},l=f=>{if(!s)return;const v=f.clientX-o,S=f.clientY-n;let g={...r},w={...u};switch(i){case"e":g.width=Math.max(t.minSize.width,r.width+v);break;case"w":g.width=Math.max(t.minSize.width,r.width-v),w.x=u.x+(r.width-g.width);break;case"s":g.height=Math.max(t.minSize.height,r.height+S);break;case"n":g.height=Math.max(t.minSize.height,r.height-S),w.y=Math.max(0,u.y+(r.height-g.height));break;case"se":g.width=Math.max(t.minSize.width,r.width+v),g.height=Math.max(t.minSize.height,r.height+S);break;case"sw":g.width=Math.max(t.minSize.width,r.width-v),g.height=Math.max(t.minSize.height,r.height+S),w.x=u.x+(r.width-g.width);break;case"ne":g.width=Math.max(t.minSize.width,r.width+v),g.height=Math.max(t.minSize.height,r.height-S),w.y=Math.max(0,u.y+(r.height-g.height));break;case"nw":g.width=Math.max(t.minSize.width,r.width-v),g.height=Math.max(t.minSize.height,r.height-S),w.x=u.x+(r.width-g.width),w.y=Math.max(0,u.y+(r.height-g.height));break}this.resizeWindow(t.id,g),(w.x!==t.position.x||w.y!==t.position.y)&&this.moveWindow(t.id,w)},m=()=>{s&&(s=!1,this.debouncedSaveWindowConfigurations(),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",m))};document.addEventListener("mousemove",l),document.addEventListener("mouseup",m),e.preventDefault()}getWindow(e){return this.windows.get(e)}getAllWindows(){return Array.from(this.windows.values())}getVisibleWindows(){return this.getAllWindows().filter(e=>!e.isMinimized)}getMinimizedWindows(){return this.getAllWindows().filter(e=>e.isMinimized)}activateWindow(e){const t=this.windows.get(e);if(t){for(const i of this.windows.values())i.id!==e&&i.isActive&&(i.isActive=!1,this.updateWindowElement(i));t.isActive=!0,t.zIndex=this.nextZIndex++,this.activeWindowId=e,this.updateWindowElement(t),a.emit("window:activated",t)}}minimizeWindow(e){const t=this.windows.get(e);if(!t)return;t.isMinimized=!0,t.isActive=!1,this.updateWindowElement(t),a.emit("window:minimized",t);const i=this.getVisibleWindows();i.length>0&&i[0]&&this.activateWindow(i[0].id)}maximizeWindow(e){this.toggleFullscreen(e)}toggleFullscreen(e){const t=this.windows.get(e);t&&(t.isFullscreen=!t.isFullscreen,this.updateWindowElement(t),t.isFullscreen?a.emit("window:maximized",t):a.emit("window:restored",t))}toggleTack(e){const t=this.windows.get(e);t&&(t.isTack=!t.isTack,this.updateWindowElement(t))}closeWindow(e){const t=this.windows.get(e);if(!t)return;const i=t.componentInstance;if(i&&typeof i.unmount=="function")try{const o=i.unmount();o&&typeof o.catch=="function"&&o.catch(n=>{console.error(`Error unmounting component for window '${e}':`,n)})}catch(o){console.error(`Error unmounting component for window '${e}':`,o)}const s=document.getElementById(`window-${e}`);if(s&&s.remove(),this.windows.delete(e),a.emit("window:closed",t),this.activeWindowId===e){this.activeWindowId=null;const o=this.getVisibleWindows();o.length>0&&o[0]&&this.activateWindow(o[0].id)}console.log(`Window '${e}' closed`)}moveWindow(e,t){const i=this.windows.get(e);i&&(i.position=t,this.updateWindowElement(i),a.emit("window:moved",i,t))}resizeWindow(e,t){const i=this.windows.get(e);i&&(i.size=t,this.updateWindowElement(i),a.emit("window:resized",i,t))}setWindowZIndex(e,t){const i=this.windows.get(e);i&&(i.zIndex=t,this.updateWindowElement(i))}updateWindowElement(e){const t=document.getElementById(`window-${e.id}`);if(!t)return;this.applyWindowStyles(t,e);const i=t.querySelector(".window-title");i&&(i.textContent=e.title);const s=t.querySelector(".window-control.tack");s&&s.classList.toggle("pinned",e.isTack)}getDefaultPosition(){const e=this.windows.size*30;return{x:100+e,y:100+e}}loadWindowConfigurations(){try{const e=localStorage.getItem("vfs-window-configs");if(e){const t=JSON.parse(e);console.log("Loaded window configurations from storage")}}catch(e){console.warn("Failed to load window configurations:",e)}}saveWindowConfiguration(e){try{const t=this.windows.get(e);if(!t)return;const i=localStorage.getItem("vfs-window-configs")||"{}",s=JSON.parse(i);s[e]={position:t.position,size:t.size,isFullscreen:t.isFullscreen},localStorage.setItem("vfs-window-configs",JSON.stringify(s))}catch(t){console.warn("Failed to save window configuration:",t)}}getWindowRegistry(){return this.registry}setupUserConfigIntegration(){try{a.on("userconfig:loaded",()=>this.restoreWindowsFromConfig()),a.on("auth:logout",()=>this.clearWindowState()),a.on("window:moved",()=>this.debouncedSaveWindowConfigurations()),a.on("window:resized",()=>this.debouncedSaveWindowConfigurations()),a.on("window:closed",()=>this.debouncedSaveWindowConfigurations()),console.log("Window Manager: User config integration setup complete")}catch(e){console.warn("Window Manager: Failed to setup user config integration:",e)}}async restoreWindowsFromConfig(){try{const t=c.get(h.USER_CONFIG_SERVICE).getSavedWindows();if(t.length>0){console.log(`Window Manager: Restoring ${t.length} windows from config`);for(const i of t)if(!this.windows.has(i.id))try{await this.createWindow(i.id,{...i.title&&{title:i.title},position:i.position,size:i.size,...i.isMinimized!==void 0&&{isMinimized:i.isMinimized},...i.isFullscreen!==void 0&&{isFullscreen:i.isFullscreen},...i.isTack!==void 0&&{isTack:i.isTack},...i.componentInputs&&{componentInputs:i.componentInputs}})}catch(s){console.warn(`Failed to restore window '${i.id}':`,s)}}}catch(e){console.warn("Window Manager: Failed to restore windows from config:",e)}}async saveWindowConfigurations(){try{const e=c.get(h.USER_CONFIG_SERVICE),t=[];for(const i of this.windows.values())t.push({id:i.id,title:i.title,position:i.position,size:i.size,minSize:i.minSize,zIndex:i.zIndex,isMinimized:i.isMinimized,isFullscreen:i.isFullscreen,isTack:i.isTack,componentInputs:i.componentInputs||{}});await e.saveWindowConfig(t),console.log(`Window Manager: Saved ${t.length} window configurations to UserConfig`)}catch(e){console.warn("Window Manager: Failed to save window configurations:",e)}}debouncedSaveWindowConfigurations(){this.saveConfigTimeout||console.log("Window Manager: Debounced save triggered"),this.saveConfigTimeout!==null&&clearTimeout(this.saveConfigTimeout),this.saveConfigTimeout=window.setTimeout(()=>{this.saveWindowConfigurations().catch(e=>{console.warn("Debounced save failed:",e)}),this.saveConfigTimeout=null},this.saveConfigDebounceMs)}clearWindowState(){for(const e of this.windows.keys())this.closeWindow(e);console.log("Window Manager: Window state cleared")}async getSavedWindowConfig(e){try{const s=c.get(h.USER_CONFIG_SERVICE).getSavedWindows().find(o=>o.id===e);return s?console.log(`Window Manager: Found saved config for '${e}':`,s):console.log(`Window Manager: No saved config found for '${e}'`),s||null}catch(t){return console.warn(`Failed to get saved config for window '${e}':`,t),null}}async destroy(){this.saveConfigTimeout!==null&&(clearTimeout(this.saveConfigTimeout),this.saveConfigTimeout=null),a.off("userconfig:loaded",this.restoreWindowsFromConfig),a.off("auth:logout",this.clearWindowState),a.off("window:moved",this.debouncedSaveWindowConfigurations),a.off("window:resized",this.debouncedSaveWindowConfigurations),a.off("window:closed",this.debouncedSaveWindowConfigurations);for(const e of this.windows.keys())this.closeWindow(e);this.windows.clear(),this.registry.clear(),this.activeWindowId=null,console.log("Window Manager destroyed")}}class W{name="DesktopService";apps=[];osStyle="macos";theme="light";async initialize(){console.log("Initializing Desktop Service..."),this.loadPreferences(),this.registerDefaultApps(),console.log("Desktop Service initialized")}loadPreferences(){try{const e=localStorage.getItem("vfs-os-style");(e==="macos"||e==="windows")&&(this.osStyle=e);const t=localStorage.getItem("vfs-theme");(t==="light"||t==="dark")&&(this.theme=t)}catch(e){console.warn("Failed to load preferences:",e)}}registerDefaultApps(){this.apps=[{id:"file-explorer",name:"File Explorer",icon:"folder",category:"file-management"},{id:"login",name:"Login",icon:"login",category:"authentication"},{id:"register",name:"Register",icon:"person_add",category:"authentication"},{id:"settings",name:"Settings",icon:"settings",category:"system"},{id:"terminal",name:"Terminal",icon:"terminal",category:"development"},{id:"text-editor",name:"Text Editor",icon:"edit",category:"productivity"},{id:"calculator",name:"Calculator",icon:"calculate",category:"utilities"},{id:"chat",name:"Chat",icon:"chat",category:"communication"},{id:"test-web-component",name:"Test Web Component",icon:"code",category:"development"},{id:"todo-app",name:"Todo App",icon:"check_circle",category:"productivity"}],console.log(`Registered ${this.apps.length} desktop applications`)}getApps(){return[...this.apps]}async launchApp(e){const t=this.apps.find(i=>i.id===e);if(!t)throw new Error(`Application '${e}' not found`);try{const i=c.get(h.WINDOW_MANAGER),s=i.getWindow(e);if(s){s.isMinimized,i.activateWindow(e);return}const o=await i.createWindow(e,{title:t.name});t.component&&await this.loadAppComponent(o.id,t.component),a.emit("desktop:app-launched",e,t),console.log(`Launched application: ${t.name}`)}catch(i){throw console.error(`Failed to launch application '${e}':`,i),i}}async loadAppComponent(e,t){try{const i=document.getElementById(`window-content-${e}`);if(!i)throw new Error(`Window content element not found for window '${e}'`);const s=new t(i);s.mount&&await s.mount(),console.log(`Component loaded for window '${e}'`)}catch(i){throw console.error(`Failed to load component for window '${e}':`,i),i}}isAppActive(e){const i=c.get(h.WINDOW_MANAGER).getWindow(e);return i!==void 0&&!i.isMinimized}getOSStyle(){return this.osStyle}setOSStyle(e){if(this.osStyle!==e){this.osStyle=e;try{localStorage.setItem("vfs-os-style",e)}catch(t){console.warn("Failed to save OS style preference:",t)}this.updateDesktopForOSStyle(e),a.emit("desktop:os-style-changed",e),console.log(`OS style changed to: ${e}`)}}updateDesktopForOSStyle(e){const t=document.querySelector(".desktop-container");t&&(t.classList.remove("os-macos","os-windows"),t.classList.add(`os-${e}`))}getTheme(){return this.theme}setTheme(e){if(this.theme!==e){this.theme=e;try{localStorage.setItem("vfs-theme",e)}catch(t){console.warn("Failed to save theme preference:",t)}document.documentElement.setAttribute("data-theme",e),a.emit("desktop:theme-changed",e),console.log(`Theme changed to: ${e}`)}}toggleTheme(){const e=this.theme==="light"?"dark":"light";this.setTheme(e)}registerApp(e){const t=this.apps.findIndex(i=>i.id===e.id);t>=0?this.apps[t]=e:this.apps.push(e),console.log(`Registered application: ${e.name}`)}unregisterApp(e){const t=this.apps.findIndex(i=>i.id===e);if(t>=0){const i=this.apps[t];this.apps.splice(t,1),i&&console.log(`Unregistered application: ${i.name}`)}}getAppsByCategory(e){return this.apps.filter(t=>t.category===e)}getCategories(){const e=new Set(this.apps.map(t=>t.category).filter(t=>!!t));return Array.from(e).sort()}searchApps(e){const t=e.toLowerCase();return this.apps.filter(i=>i.name.toLowerCase().includes(t)||i.id.toLowerCase().includes(t)||i.category&&i.category.toLowerCase().includes(t))}getApp(e){return this.apps.find(t=>t.id===e)}getDockedApps(){return this.apps.filter(e=>["file-explorer","terminal","text-editor","calculator","chat","settings","test-web-component","todo-app"].includes(e.id))}async destroy(){this.apps=[],console.log("Desktop Service destroyed")}}class M{name="AuthService";authState={isAuthenticated:!1,user:null,token:null};apiBaseUrl="/api";async initialize(){console.log("Initializing Auth Service..."),await this.restoreSession(),console.log("Auth Service initialized")}async restoreSession(){try{const e=localStorage.getItem("vfs-auth-token"),t=localStorage.getItem("vfs-auth-user");if(e&&t){const i=JSON.parse(t);await this.validateToken(e)?(this.authState={isAuthenticated:!0,user:i,token:e},console.log("Session restored for user:",i.username),a.emit("auth:login",i)):this.clearStoredAuth()}}catch(e){console.warn("Failed to restore session:",e),this.clearStoredAuth()}}async validateToken(e){try{return(await fetch(`${this.apiBaseUrl}/auth/user`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},cache:"no-cache"})).ok}catch(t){return console.warn("Token validation failed:",t),!1}}async login(e,t){try{const i=await fetch(`${this.apiBaseUrl}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(!i.ok){const o=await i.json().catch(()=>({}));throw new Error(o.message||"Login failed")}const s=await i.json();return this.authState={isAuthenticated:!0,user:s,token:s.token||null},this.storeAuth(s,s.token||""),a.emit("auth:login",s),console.log("User logged in:",s.username),s}catch(i){throw console.error("Login failed:",i),i}}async register(e,t,i){try{const s=await fetch(`${this.apiBaseUrl}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,email:i})});if(!s.ok){const n=await s.json().catch(()=>({}));throw new Error(n.message||"Registration failed")}const o=await s.json();return o.token?(this.authState={isAuthenticated:!0,user:o,token:o.token},this.storeAuth(o,o.token),a.emit("auth:login",o),console.log("User registered and logged in:",o.username),o):(console.log("User registered successfully:",o.username),o)}catch(s){throw console.error("Registration failed:",s),s}}async logout(){try{this.authState={isAuthenticated:!1,user:null,token:null},this.clearStoredAuth(),a.emit("auth:logout"),console.log("User logged out")}catch(e){throw console.error("Logout failed:",e),e}}getCurrentUser(){return this.authState.user}isAuthenticated(){return this.authState.isAuthenticated}getToken(){return this.authState.token}getAuthState(){return{...this.authState}}hasRole(e){return this.authState.user?.roles?.includes(e)??!1}hasAnyRole(e){return e.some(t=>this.hasRole(t))}isAdmin(){return this.hasAnyRole(["Admin","SuperAdmin"])}storeAuth(e,t){try{localStorage.setItem("vfs-auth-token",t),localStorage.setItem("vfs-auth-user",JSON.stringify({id:e.id,username:e.username,email:e.email,roles:e.roles}))}catch(i){console.warn("Failed to store auth data:",i)}}clearStoredAuth(){try{localStorage.removeItem("vfs-auth-token"),localStorage.removeItem("vfs-auth-user")}catch(e){console.warn("Failed to clear stored auth data:",e)}}async refreshToken(){try{if(!this.authState.token)throw new Error("No token to refresh");const e=await fetch(`${this.apiBaseUrl}/auth/refresh`,{method:"POST",headers:{Authorization:`Bearer ${this.authState.token}`}});if(!e.ok)throw new Error("Token refresh failed");const i=(await e.json()).token;return this.authState.token=i,this.authState.user&&(this.authState.user.token=i,this.storeAuth(this.authState.user,i)),console.log("Token refreshed successfully"),i}catch(e){return console.error("Token refresh failed:",e),await this.logout(),a.emit("auth:token-expired"),null}}getUserDisplayName(){const e=this.authState.user;return e?e.username||e.email||"User":"Guest"}async updateProfile(e){throw new Error("Profile update not yet implemented on server")}async changePassword(e,t){throw new Error("Password change not yet implemented on server")}async destroy(){this.authState.isAuthenticated&&await this.logout(),console.log("Auth Service destroyed")}}class D{name="ThemeService";currentTheme="light";systemPreference="light";async initialize(){console.log("Initializing Theme Service..."),this.detectSystemTheme(),this.loadTheme(),this.setupSystemThemeListener(),console.log("Theme Service initialized")}detectSystemTheme(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?this.systemPreference="dark":this.systemPreference="light"}loadTheme(){try{const e=localStorage.getItem("vfs-theme");e==="light"||e==="dark"?this.setTheme(e):this.setTheme(this.systemPreference)}catch(e){console.warn("Failed to load theme preference:",e),this.setTheme(this.systemPreference)}}setupSystemThemeListener(){window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addListener(t=>{this.systemPreference=t.matches?"dark":"light",localStorage.getItem("vfs-theme")||this.setTheme(this.systemPreference)})}getTheme(){return this.currentTheme}setTheme(e){if(this.currentTheme!==e){this.currentTheme=e,document.documentElement.setAttribute("data-theme",e);try{localStorage.setItem("vfs-theme",e)}catch(t){console.warn("Failed to save theme preference:",t)}a.emit("desktop:theme-changed",e),console.log(`Theme set to: ${e}`)}}toggleTheme(){const e=this.currentTheme==="light"?"dark":"light";this.setTheme(e)}getSystemPreference(){return this.systemPreference}useSystemTheme(){this.setTheme(this.systemPreference)}isUsingSystemTheme(){return this.currentTheme===this.systemPreference}getAvailableThemes(){return["light","dark"]}applyThemeToElement(e,t){const i=t||this.currentTheme;e.setAttribute("data-theme",i)}removeThemeFromElement(e){e.removeAttribute("data-theme")}getCSSProperty(e){return getComputedStyle(document.documentElement).getPropertyValue(e)}setCSSProperty(e,t){document.documentElement.style.setProperty(e,t)}getColorPalette(){return{background:this.getCSSProperty("--bg"),backgroundSecondary:this.getCSSProperty("--bg-secondary"),text:this.getCSSProperty("--text"),textSecondary:this.getCSSProperty("--text-secondary"),accent:this.getCSSProperty("--accent"),border:this.getCSSProperty("--border"),success:this.getCSSProperty("--success"),warning:this.getCSSProperty("--warning"),danger:this.getCSSProperty("--danger")}}isDarkTheme(){return this.currentTheme==="dark"}isLightTheme(){return this.currentTheme==="light"}async destroy(){document.documentElement.removeAttribute("data-theme"),console.log("Theme Service destroyed")}}const x="modulepreload",L=function(d){return"/"+d},T={},p=function(e,t,i){if(!t||t.length===0)return e();const s=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=L(o),o in T)return;T[o]=!0;const n=o.endsWith(".css"),r=n?'[rel="stylesheet"]':"";if(!!i)for(let m=s.length-1;m>=0;m--){const f=s[m];if(f.href===o&&(!n||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${r}`))return;const l=document.createElement("link");if(l.rel=n?"stylesheet":x,n||(l.as="script",l.crossOrigin=""),l.href=o,document.head.appendChild(l),n)return new Promise((m,f)=>{l.addEventListener("load",m),l.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e()).catch(o=>{const n=new Event("vite:preloadError",{cancelable:!0});if(n.payload=o,window.dispatchEvent(n),!n.defaultPrevented)throw o})};class I{name="ComponentLoaderService";registry={};async initialize(){console.log("Initializing Component Loader Service..."),this.registerDefaultComponents(),console.log("Component Loader Service initialized")}registerDefaultComponents(){this.registerComponent("login",()=>p(()=>import("./login.component-2acd754b.js"),[]).then(e=>e.LoginComponent)),this.registerComponent("register",()=>p(()=>import("./register.component-c1b7b615.js"),[]).then(e=>e.RegisterComponent)),this.registerComponent("file-explorer",()=>p(()=>import("./file-explorer.component-ed9cca65.js"),[]).then(e=>e.FileExplorerComponent)),this.registerComponent("test-web-component",()=>p(()=>import("./test-web-component-d1b6b71b.js"),[]).then(e=>e.TestWebComponent)),this.registerComponent("todo-app",()=>p(()=>import("./todo-app.component-128f6b80.js"),[]).then(e=>e.TodoAppComponent)),this.registerComponent("add-todo",()=>p(()=>import("./add-todo.component-c2b7a5e9.js"),[]).then(e=>e.AddTodoComponent)),this.registerComponent("todo-item",()=>p(()=>import("./todo-item.component-174ce962.js"),[]).then(e=>e.TodoItemComponent))}registerComponent(e,t){this.registry[e]=t,console.log(`Component '${e}' registered`)}async loadComponent(e,t,i){const s=this.registry[e];if(!s)return console.warn(`Component '${e}' not found in registry`),null;try{console.log(`Loading component '${e}'...`);const o=await s();if(this.isWebComponent(o))return this.createWebComponentAdapter(o,t,i);{const n=new o(t,i);return console.log(`Component '${e}' loaded successfully`),n}}catch(o){return console.error(`Failed to load component '${e}':`,o),null}}isWebComponent(e){return e.prototype instanceof HTMLElement}createWebComponentAdapter(e,t,i){let s=null;return{container:t,inputs:i,mount:()=>{const o=new e;s=o,i&&Object.entries(i).forEach(([n,r])=>{typeof r=="string"?o.setAttribute(n,r):typeof r=="boolean"?r?o.setAttribute(n,""):o.removeAttribute(n):o[n]=r}),t.appendChild(o)},unmount:()=>{s&&t.contains(s)&&(t.removeChild(s),s=null)},update:o=>{s&&s instanceof e&&Object.entries(o).forEach(([n,r])=>{typeof r=="string"?s.setAttribute(n,r):typeof r=="boolean"?r?s.setAttribute(n,""):s.removeAttribute(n):s[n]=r})}}}hasComponent(e){return e in this.registry}getRegisteredComponents(){return Object.keys(this.registry)}async dispose(){this.registry={},console.log("Component Loader Service disposed")}}class P{name="UserConfigService";authService;config=null;apiBaseUrl="/api";apiUrl="/user/config";lastSaveAttempt=null;lastSaveSuccess=null;lastSaveError=null;isDebugMode=!0;saveTimeout=null;saveDebounceMs=2e3;async initialize(){console.log("Initializing User Config Service..."),this.authService=c.get(h.AUTH_SERVICE),a.on("auth:login",()=>this.fetchConfig()),a.on("auth:logout",()=>this.clearConfig()),this.authService.isAuthenticated()&&this.fetchConfig(),console.log("User Config Service initialized")}getConfig(){return this.config}getSaveStatus(){return{lastAttempt:this.lastSaveAttempt,lastSuccess:this.lastSaveSuccess,lastError:this.lastSaveError}}async fetchConfig(){if(!this.authService.isAuthenticated()){console.log("Not fetching config: user not authenticated");return}this.isDebugMode&&console.log("UserConfigService: Fetching user config");try{const e=this.getAuthHeaders();if(!e){this.isDebugMode&&console.log("UserConfigService: No auth token available, skipping config fetch");return}const t=await fetch(`${this.apiBaseUrl}${this.apiUrl}`,{method:"GET",headers:e});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const i=await t.json();if(this.config=i,this.isDebugMode){console.log("UserConfigService: Config fetched successfully",i);const s=i?.settings?.windows?.length||0;console.log(`UserConfigService: Config contains ${s} windows`)}a.emit("userconfig:loaded",i)}catch(e){console.error("Error fetching user config:",e),a.emit("userconfig:error",e)}}async saveConfig(e){if(!this.authService.isAuthenticated()){console.log("Not saving config: user not authenticated");return}if(this.lastSaveAttempt=new Date,this.isDebugMode){console.log("UserConfigService: Saving user config",e);const s=e?.settings?.windows?.length||0,o=e?.windows?.length||0;s>0&&console.log(`UserConfigService: Found ${s} windows in settings.windows structure`),o>0&&console.log(`UserConfigService: Found ${o} windows at root level`)}let t={};e.settings?t=e.settings:t=e;const i={Settings:t};try{const s=this.getAuthHeaders();if(!s){this.isDebugMode&&console.log("UserConfigService: No auth token available, skipping config save");return}this.isDebugMode&&(console.log("UserConfigService: Using auth token for config save"),console.log("UserConfigService: Saving config to server",{hasSettings:!!i.Settings,settingsKeys:Object.keys(i.Settings||{})}));const o=await fetch(`${this.apiBaseUrl}${this.apiUrl}`,{method:"POST",headers:{"Content-Type":"application/json",...s},body:JSON.stringify(i)});if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);const n=await o.json();this.config=n,this.lastSaveSuccess=new Date,this.lastSaveError=null,this.isDebugMode&&console.log("UserConfigService: Config saved successfully"),a.emit("userconfig:saved",n)}catch(s){const o=s instanceof Error?s.message:"Unknown error";this.lastSaveError=o,console.error("Error saving user config:",s),a.emit("userconfig:error",s)}}async saveWindowConfig(e){this.isDebugMode&&console.log("UserConfigService: Scheduling debounced window configuration save",{windowCount:e.length}),this.saveTimeout!==null&&clearTimeout(this.saveTimeout),this.saveTimeout=window.setTimeout(async()=>{try{this.isDebugMode&&console.log("UserConfigService: Executing debounced window configuration save");const i={...this.config?.settings||{},windows:e};await this.saveConfig({settings:i})}catch(t){console.warn("Debounced window config save failed:",t)}finally{this.saveTimeout=null}},this.saveDebounceMs)}getSavedWindows(){const e=this.config?.settings?.windows;return Array.isArray(e)?e:[]}async updateSetting(e,t){const s={...this.config?.settings||{},[e]:t};await this.saveConfig({settings:s})}getSetting(e,t){return this.config?.settings?.[e]??t}clearConfig(){this.config=null,this.lastSaveAttempt=null,this.lastSaveSuccess=null,this.lastSaveError=null,this.isDebugMode&&console.log("UserConfigService: Config cleared"),a.emit("userconfig:cleared")}getAuthHeaders(){const e=this.authService.getCurrentUser();return!e||!e.token?null:{Authorization:`Bearer ${e.token}`}}async dispose(){this.saveTimeout!==null&&(clearTimeout(this.saveTimeout),this.saveTimeout=null),a.off("auth:login",this.fetchConfig),a.off("auth:logout",this.clearConfig),console.log("User Config Service disposed")}}class R{constructor(e,t){this.container=e,this.inputs=t,this.bindMethods()}_mounted=!1;_destroyed=!1;bindMethods(){const e=Object.getOwnPropertyNames(Object.getPrototypeOf(this));for(const t of e){const i=this[t];typeof i=="function"&&t!=="constructor"&&(this[t]=i.bind(this))}}unmount(){this._mounted=!1,this._destroyed=!0,this.container.innerHTML=""}update(e){this.inputs={...this.inputs,...e}}get isMounted(){return this._mounted}get isDestroyed(){return this._destroyed}createElement(e,t,i){const s=document.createElement(e);if(t)for(const[o,n]of Object.entries(t))s.setAttribute(o,n);return i&&(s.textContent=i),s}addEventListener(e,t,i,s){const o=i;e.addEventListener(t,o,s),this._eventListeners||(this._eventListeners=[]),this._eventListeners.push({element:e,type:t,listener:o,options:s})}_eventListeners;cleanupEventListeners(){if(this._eventListeners){for(const{element:e,type:t,listener:i,options:s}of this._eventListeners)e.removeEventListener(t,i,s);this._eventListeners=[]}}async baseUnmount(){this.cleanupEventListeners(),this._mounted=!1,this._destroyed=!0}setCSSProperty(e,t){this.container.style.setProperty(e,t)}getCSSProperty(e){return getComputedStyle(this.container).getPropertyValue(e)}addClass(...e){this.container.classList.add(...e)}removeClass(...e){this.container.classList.remove(...e)}toggleClass(e,t){this.container.classList.toggle(e,t)}querySelector(e){return this.container.querySelector(e)}querySelectorAll(e){return this.container.querySelectorAll(e)}appendElement(e,t,i,s){const o=this.createElement(e,t,i);return(s||this.container).appendChild(o),o}emit(e,t){const i=new CustomEvent(e,{detail:t});this.container.dispatchEvent(i)}getInput(e,t){return this.inputs?.[e]??t}setInput(e,t){this.inputs||(this.inputs={}),this.inputs[e]=t}}class _ extends R{windowManager;desktopService;authService;userConfigService;currentTime=new Date;timeUpdateInterval;async mount(){console.log("Mounting Desktop component..."),this.windowManager=c.get(h.WINDOW_MANAGER),this.desktopService=c.get(h.DESKTOP_SERVICE),this.authService=c.get(h.AUTH_SERVICE),this.userConfigService=c.get(h.USER_CONFIG_SERVICE),this.buildDesktopStructure(),this.setupEventListeners(),this.startTimeUpdates(),this.updateOSStyle(),this._mounted=!0,console.log("Desktop component mounted")}buildDesktopStructure(){this.container.innerHTML="",this.container.className="desktop-container";const e=this.desktopService.getOSStyle();this.container.classList.add(`os-${e}`),this.createMenuBar(),this.createWindowsContainer(),this.createDockTaskbar(),this.createDesktopIcons()}createMenuBar(){const e=this.createElement("div",{class:"menu-bar"}),t=this.createElement("div",{class:"menu-app-name"},"VFS Desktop");this.addEventListener(t,"click",()=>this.toggleFileExplorer()),e.appendChild(t);const i=this.createElement("div",{class:"menu-items"});e.appendChild(i);const s=this.createElement("div",{class:"menu-status-icons"});this.createAuthSection(s);const o=this.createElement("div",{class:"menu-status-icon"});o.title="Toggle Theme",this.addEventListener(o,"click",()=>this.toggleTheme()),s.appendChild(o);const n=this.createElement("div",{class:"menu-status-icon"});n.title="Switch OS Style",this.addEventListener(n,"click",()=>this.toggleOSStyle()),s.appendChild(n);const r=this.createElement("div",{class:"menu-status-icon",id:"time-display"});this.updateTimeDisplay(r),s.appendChild(r),e.appendChild(s),this.container.appendChild(e)}createAuthSection(e){const t=this.createElement("div",{class:"auth-section"});if(this.authService.isAuthenticated()){const i=this.authService.getCurrentUser(),s=this.createElement("div",{class:"menu-auth-button"}),o=this.createElement("span",{class:"material-icons"},"account_circle"),n=this.createElement("span",{},i.username);s.appendChild(o),s.appendChild(n),this.addEventListener(s,"click",()=>this.openUserProfile()),t.appendChild(s)}else{const i=this.createElement("div",{class:"menu-auth-button"});i.innerHTML=`
        <span class="material-icons">login</span>
        <span>Login</span>
      `,this.addEventListener(i,"click",()=>this.openLogin()),t.appendChild(i);const s=this.createElement("div",{class:"menu-auth-button"});s.innerHTML=`
        <span class="material-icons">person_add</span>
        <span>Register</span>
      `,this.addEventListener(s,"click",()=>this.openRegister()),t.appendChild(s)}e.appendChild(t)}createWindowsContainer(){const e=this.createElement("div",{class:"windows-container",id:"windows-container"});this.container.appendChild(e)}createDockTaskbar(){this.desktopService.getOSStyle()==="macos"?this.createDock():this.createTaskbar()}createDock(){const e=this.createElement("div",{class:"dock-container"}),t=this.createElement("div",{class:"dock"});let i=this.desktopService.getDockedApps();i.length===0&&(i=this.desktopService.getApps().slice(0,6));for(const s of i){const o=this.createElement("div",{class:"dock-item","data-app-id":s.id}),n=this.createElement("span",{class:"material-icons"},s.icon),r=this.createElement("span",{class:"dock-tooltip"},s.name);if(o.appendChild(n),o.appendChild(r),this.desktopService.isAppActive(s.id)){const u=this.createElement("div",{class:"dock-indicator"});o.appendChild(u),o.classList.add("active")}this.addEventListener(o,"click",()=>this.toggleApp(s.id)),t.appendChild(o)}e.appendChild(t),this.container.appendChild(e)}createTaskbar(){const e=this.createElement("div",{class:"windows-taskbar"}),t=this.createElement("div",{class:"taskbar-start"});t.innerHTML=`
      <span class="material-icons">apps</span>
      <span>Start</span>
    `,this.addEventListener(t,"click",()=>this.toggleStartMenu()),e.appendChild(t);const i=this.createElement("div",{class:"taskbar-apps"});this.updateTaskbarApps(i),e.appendChild(i);const s=this.createElement("div",{class:"taskbar-system"}),o=this.createElement("div",{class:"system-tray"}),n=this.createElement("span",{class:"material-icons",title:"Switch OS Style"},"desktop_windows");this.addEventListener(n,"click",()=>this.toggleOSStyle()),o.appendChild(n),s.appendChild(o);const r=this.createElement("div",{class:"taskbar-clock",id:"taskbar-time-display"});this.updateTimeDisplay(r),s.appendChild(r),e.appendChild(s),this.container.appendChild(e)}updateTaskbarApps(e){e.innerHTML="";const t=this.windowManager.getVisibleWindows();for(const i of t){const s=this.desktopService.getApp(i.id);if(!s)continue;const o=this.createElement("div",{class:"taskbar-item active",title:s.name}),n=this.createElement("span",{class:"material-icons"},s.icon),r=this.createElement("span",{class:"app-name"},s.name);o.appendChild(n),o.appendChild(r),this.addEventListener(o,"click",()=>this.toggleApp(s.id)),e.appendChild(o)}}createDesktopIcons(){const e=this.createElement("div",{class:"desktop-icons"});this.addDesktopIcon(e,"folder","Documents",()=>this.openDocuments()),this.addDesktopIcon(e,"settings","Settings",()=>this.openSettings()),this.container.appendChild(e)}addDesktopIcon(e,t,i,s){const o=this.createElement("div",{class:"desktop-icon"}),n=this.createElement("span",{class:"icon material-icons"},t),r=this.createElement("span",{class:"icon-label"},i);o.appendChild(n),o.appendChild(r),this.addEventListener(o,"click",s),this.addEventListener(o,"dblclick",s),e.appendChild(o)}setupEventListeners(){a.on("auth:login",()=>this.updateAuthSection()),a.on("auth:logout",()=>this.updateAuthSection()),a.on("window:created",()=>this.updateDockTaskbar()),a.on("window:closed",()=>this.updateDockTaskbar()),a.on("window:activated",()=>this.updateDockTaskbar()),a.on("desktop:os-style-changed",()=>this.updateOSStyle()),a.on("desktop:theme-changed",()=>this.updateThemeDisplay())}startTimeUpdates(){this.updateTime(),this.timeUpdateInterval=window.setInterval(()=>{this.updateTime()},6e4)}updateTime(){this.currentTime=new Date;const e=document.getElementById("time-display");e&&this.updateTimeDisplay(e);const t=document.getElementById("taskbar-time-display");t&&this.updateTimeDisplay(t)}updateTimeDisplay(e){const t=this.currentTime.getHours(),i=this.currentTime.getMinutes(),s=t>=12?"PM":"AM",o=t%12||12,n=i<10?`0${i}`:i;e.textContent=`${o}:${n} ${s}`}updateOSStyle(){const e=this.desktopService.getOSStyle();this.container.classList.remove("os-macos","os-windows"),this.container.classList.add(`os-${e}`);const t=this.container.querySelector(".dock-container, .windows-taskbar");t&&t.remove(),this.createDockTaskbar(),this.updateOSToggleDisplay()}updateOSToggleDisplay(){const e=this.desktopService.getOSStyle(),t=this.container.querySelectorAll('[title="Switch OS Style"]');for(const i of t)i.textContent=e==="macos"?"🍎":"⊞"}updateThemeDisplay(){const e=this.desktopService.getTheme(),t=this.container.querySelectorAll('[title="Toggle Theme"]');for(const i of t)i.textContent=e==="dark"?"🌙 Dark":"☀️ Light"}updateAuthSection(){const e=this.container.querySelector(".auth-section");e&&e.remove();const t=this.container.querySelector(".menu-status-icons");t&&t instanceof HTMLElement&&this.createAuthSection(t)}updateDockTaskbar(){if(this.desktopService.getOSStyle()==="macos"){const t=this.container.querySelector(".dock");t&&this.updateDockItems(t)}else{const t=this.container.querySelector(".taskbar-apps");t&&this.updateTaskbarApps(t)}}updateDockItems(e){const t=e.querySelectorAll(".dock-item");for(const i of t){const s=i.getAttribute("data-app-id");if(s){const o=this.desktopService.isAppActive(s);i.classList.toggle("active",o);const n=i.querySelector(".dock-indicator");if(o&&!n){const r=this.createElement("div",{class:"dock-indicator"});i.appendChild(r)}else!o&&n&&n.remove()}}}toggleFileExplorer(){this.toggleApp("file-explorer")}toggleApp(e){this.desktopService.launchApp(e).catch(console.error)}toggleTheme(){this.desktopService.toggleTheme()}toggleOSStyle(){const t=this.desktopService.getOSStyle()==="macos"?"windows":"macos";this.desktopService.setOSStyle(t)}openLogin(){this.toggleApp("login")}openRegister(){this.toggleApp("register")}openUserProfile(){this.toggleApp("user-profile")}openDocuments(){this.toggleApp("file-explorer")}openSettings(){this.toggleApp("settings")}toggleStartMenu(){console.log("Start menu clicked")}async unmount(){this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this.cleanupEventListeners(),await this.baseUnmount(),console.log("Desktop component unmounted")}}class C{static instance;components=new Map;modules=new Map;loadingPromises=new Map;constructor(){}static getInstance(){return C.instance||(C.instance=new C),C.instance}registerComponent(e,t){const i={metadata:e,loader:t,isLoaded:!1,constructor:void 0};this.components.set(e.id,i),a.emit("component:registered",{componentId:e.id,metadata:e})}registerModule(e,t){this.modules.set(e.id,e);for(const i of t)this.registerComponent(i.metadata,i.loader);a.emit("module:loaded",{moduleId:e.id,module:e,componentCount:t.length})}getComponentMetadata(e){return this.components.get(e)?.metadata}getAllComponents(){return Array.from(this.components.values()).map(e=>e.metadata)}getComponentsByCategory(e){return this.getAllComponents().filter(t=>t.category===e)}searchComponents(e){const t=e.toLowerCase();return this.getAllComponents().filter(i=>i.name.toLowerCase().includes(t)||i.description?.toLowerCase().includes(t)||i.tags?.some(s=>s.toLowerCase().includes(t)))}async loadComponent(e){const t=this.components.get(e);if(!t)throw new Error(`Component not found: ${e}`);if(t.isLoaded&&t.constructor)return t.constructor;if(this.loadingPromises.has(e))return this.loadingPromises.get(e);const i=performance.now(),s=t.loader().then(o=>{t.constructor=o,t.isLoaded=!0,t.loadedAt=new Date;const n=performance.now()-i;return a.emit("component:loaded",{componentId:e,loadTime:n,success:!0}),this.loadingPromises.delete(e),o}).catch(o=>{const n=performance.now()-i;throw a.emit("component:loaded",{componentId:e,loadTime:n,success:!1,error:o}),this.loadingPromises.delete(e),o});return this.loadingPromises.set(e,s),s}async preloadComponents(e={}){let t=this.getAllComponents();e.categories&&(t=t.filter(i=>e.categories.includes(i.category))),e.maxPriority&&(t=t.filter(i=>(i.loadPriority??5)<=e.maxPriority)),t.sort((i,s)=>(i.loadPriority??5)-(s.loadPriority??5)),e.maxCount&&(t=t.slice(0,e.maxCount)),await Promise.allSettled(t.map(i=>this.loadComponent(i.id)))}checkDependencies(e){const t=this.getComponentMetadata(e);if(!t?.dependencies)return{satisfied:!0,missing:[]};const i=[];for(const s of t.dependencies)s.type==="component"&&!this.components.get(s.id)?.isLoaded&&!s.optional&&i.push(s.id);return{satisfied:i.length===0,missing:i}}getLoadStatistics(){const e=Array.from(this.components.values()),t={};return e.forEach(i=>{i.loadedAt&&(t[i.metadata.id]=0)}),{total:e.length,loaded:e.filter(i=>i.isLoaded).length,loading:this.loadingPromises.size,unloaded:e.filter(i=>!i.isLoaded).length,loadTimes:t}}getAllModules(){return Array.from(this.modules.values())}getModule(e){return this.modules.get(e)}clear(){this.components.clear(),this.modules.clear(),this.loadingPromises.clear()}}const y=C.getInstance();class k{config;constructor(e){this.config=e}async scanAndRegister(){const e={componentsFound:0,componentsRegistered:0,modulesRegistered:0,errors:[]};try{if(this.config.modules)for(const t of this.config.modules)await this.registerModule(t),e.modulesRegistered++;await this.scanWithViteGlob(e)}catch(t){e.errors.push(`Scanner error: ${t instanceof Error?t.message:String(t)}`)}return e}async scanWithViteGlob(e){console.log("Component scanner initialized. Components should self-register using registerComponentFile()")}async registerModule(e){try{const t=[];for(const i of e.components){const s={id:i,name:this.generateDisplayName(i),category:e.category||"uncategorized",...e.version&&{version:e.version},defaultWindow:{title:this.generateDisplayName(i),position:{x:100,y:100},size:{width:800,height:600},minSize:{width:400,height:300},isResizable:!0,isDraggable:!0}},o=this.createComponentLoader(i,e.id);t.push({metadata:s,loader:o})}y.registerModule(e,t)}catch(t){throw new Error(`Failed to register module ${e.id}: ${t instanceof Error?t.message:String(t)}`)}}createComponentLoader(e,t){return async()=>{throw new Error(`Component loader not implemented for ${e} in module ${t}`)}}generateDisplayName(e){return e.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}static registerComponentFile(e,t,i){const s={id:e,name:t.name||e,category:t.category||"uncategorized",...t};y.registerComponent(s,i)}}function F(d){const e={basePaths:["./src/components"],patterns:["**/*.component.ts"],excludePatterns:["**/*.spec.ts","**/*.test.ts"],recursive:!0,...d};return new k(e)}const O={id:"admin",name:"Admin Module",description:"Administrative dashboard and management components",version:"1.0.0",category:"admin",components:["admin-dashboard","user-management","system-settings","analytics-dashboard","revenue-analytics","usage-analytics","performance-monitor","audit-logs","backup-restore","security-settings"],exports:[{id:"admin-service",type:"service",name:"AdminService",description:"Service for administrative operations"}]},$={id:"auth",name:"Authentication Module",description:"User authentication and session management components",version:"1.0.0",category:"auth",components:["login","register","forgot-password","reset-password","two-factor-auth","profile-settings","account-security","session-management"],exports:[{id:"auth-service",type:"service",name:"AuthService",description:"Service for user authentication"}]},U={id:"chat",name:"Chat Module",description:"Chat interface and communication components",version:"1.0.0",category:"communication",components:["chat-window","chat-list","message-composer","file-attachment","file-upload","file-display","emoji-picker","chat-settings","conversation-history","voice-chat","video-chat"]},N={id:"designer",name:"Designer Module",description:"Visual designers and workflow creation components",version:"1.0.0",category:"design",components:["workflow-designer","flowchart-designer","dsl-editor","code-editor","visual-builder","component-palette","property-inspector","canvas-editor","export-integration","template-manager"]},V={id:"desktop",name:"Desktop Module",description:"Desktop environment and window management components",version:"1.0.0",category:"desktop",components:["desktop","taskbar","start-menu","applications-menu","window-controls","system-tray","desktop-wallpaper","widget-container"]},B={id:"explorer",name:"File Explorer Module",description:"File system navigation and management components",version:"1.0.0",category:"file-management",components:["file-explorer","folder-tree","file-tree","file-browser","file-viewer","file-editor","file-properties","file-search","breadcrumb-navigation"]},H={id:"git",name:"Git Integration Module",description:"Git version control and collaboration components",version:"1.0.0",category:"version-control",components:["git-integration-window","git-diff-viewer","git-conflict-resolver","git-commit-history","git-branch-manager","git-merge-tool","git-status-panel"]},j={id:"dev-tools",name:"Development Tools Module",description:"Development utilities and debugging tools",version:"1.0.0",category:"development",components:["component-inspector","state-debugger","performance-profiler","network-monitor","console-viewer","error-boundary-display","hot-reload-manager"]},G={id:"shared",name:"Shared Components Module",description:"Reusable utility and UI components",version:"1.0.0",category:"utility",components:["modal","tooltip","dropdown","tabs","accordion","progress-bar","spinner","notification","confirmation-dialog","form-builder","data-table","pagination","search-box","date-picker","color-picker"]},q=[O,$,U,N,V,B,H,j,G];class E{static instance;scanner;isInitialized=!1;windowManagerRegistered=!1;constructor(){this.scanner=F({basePaths:["./src/components"],patterns:["**/*.component.ts"],modules:q})}static getInstance(){return E.instance||(E.instance=new E),E.instance}async initialize(){if(!this.isInitialized){console.log("🔍 Initializing component discovery system...");try{const e=await this.scanner.scanAndRegister();console.log(`✅ Component discovery completed:
        - Modules registered: ${e.modulesRegistered}
        - Components found: ${e.componentsFound}
        - Components registered: ${e.componentsRegistered}
        ${e.errors.length>0?`- Errors: ${e.errors.length}`:""}
      `),e.errors.length>0&&console.warn("Discovery errors:",e.errors),this.registerComponentLoaders(),await this.preloadCriticalComponents(),this.isInitialized=!0,a.emit("component-discovery:initialized",{modulesCount:e.modulesRegistered,componentsCount:e.componentsRegistered}),a.on("services:initialized",()=>{this.retryWindowManagerRegistration()})}catch(e){throw console.error("Failed to initialize component discovery:",e),e}}}registerComponentLoaders(){this.registerExistingComponents(),this.setupSelfRegistration(),this.registerComponentsWithWindowManager()}registerExistingComponents(){k.registerComponentFile("login",{id:"login",name:"Login",category:"auth",description:"User login component",icon:"login",defaultWindow:{title:"Login",position:{x:400,y:200},size:{width:400,height:500},minSize:{width:350,height:400},isResizable:!1,isDraggable:!0},allowMultipleInstances:!1,loadPriority:1},async()=>{const{LoginComponent:e}=await p(()=>import("./login.component-2acd754b.js"),[]);return e}),k.registerComponentFile("register",{id:"register",name:"Register",category:"auth",description:"User registration component",icon:"person_add",defaultWindow:{title:"Create Account",position:{x:450,y:150},size:{width:500,height:600},minSize:{width:400,height:500},isResizable:!1,isDraggable:!0},allowMultipleInstances:!1,loadPriority:2},async()=>{const{RegisterComponent:e}=await p(()=>import("./register.component-c1b7b615.js"),[]);return e}),k.registerComponentFile("file-explorer",{id:"file-explorer",name:"File Explorer",category:"file-management",description:"KISS Virtual File System Explorer - simplified but better in every way",icon:"📁",defaultWindow:{title:"File Explorer",position:{x:200,y:100},size:{width:800,height:600},minSize:{width:400,height:300},isResizable:!0,isDraggable:!0},allowMultipleInstances:!0,loadPriority:3,capabilities:[{id:"virtual-file-system",name:"Virtual File System",description:"Navigate and manage virtual file system"},{id:"drag-drop",name:"Drag & Drop",description:"Support for drag and drop file operations"},{id:"context-menu",name:"Context Menu",description:"Right-click context menu for file operations"},{id:"keyboard-shortcuts",name:"Keyboard Shortcuts",description:"Full keyboard navigation support"}],tags:["files","explorer","vfs","navigation","kiss"]},async()=>{const{FileExplorerComponent:e}=await p(()=>import("./file-explorer.component-ed9cca65.js"),[]);return e})}setupSelfRegistration(){}async preloadCriticalComponents(){console.log("⚡ Preloading critical components...");try{await y.preloadComponents({categories:["auth","desktop"],maxPriority:3,maxCount:10}),console.log("✅ Critical components preloaded")}catch(e){console.warn("Failed to preload some components:",e)}}registerComponentsWithWindowManager(){if(this.windowManagerRegistered){console.log("Components already registered with window manager, skipping");return}try{const e=c.get(h.WINDOW_MANAGER),t=y.getAllComponents();let i=0;for(const s of t)if(s.defaultWindow){const o={defaultTitle:s.defaultWindow.title||s.name,defaultSize:s.defaultWindow.size||{width:800,height:600},defaultPosition:s.defaultWindow.position||{x:100,y:100},minSize:s.defaultWindow.minSize||{width:400,height:300},...s.defaultWindow.maxSize&&{maxSize:s.defaultWindow.maxSize},category:s.category,isDocked:!1,isResizable:s.defaultWindow.isResizable??!0,isDraggable:s.defaultWindow.isDraggable??!0};typeof e.registerWindow=="function"&&(e.registerWindow(s.id,o),i++)}this.windowManagerRegistered=!0,console.log(`✅ Registered ${i} components with window manager`)}catch(e){console.warn("Failed to register components with window manager (will retry after services are initialized):",e)}}retryWindowManagerRegistration(){console.log("🔄 Retrying component registration with window manager..."),this.registerComponentsWithWindowManager()}getStatistics(){const e=y.getLoadStatistics(),t=y.getAllModules();return{...e,modules:t.length,isInitialized:this.isInitialized}}registerComponent(e,t,i){k.registerComponentFile(e,t,i)}async loadComponent(e){return y.loadComponent(e)}searchComponents(e){return y.searchComponents(e)}getComponentsByCategory(e){return y.getComponentsByCategory(e)}}const K=E.getInstance(),J={theme:"light",osStyle:"macos",enableAnimations:!0,animationDuration:300,defaultWindowSize:{width:800,height:600},apiBaseUrl:"/api",storagePrefix:"vfs-"};class Y{constructor(e={}){this.config=e,this.config={...J,...e}}desktop;initialized=!1;async initialize(){if(this.initialized){console.warn("VFS Desktop already initialized");return}try{console.log("Initializing VFS Desktop..."),this.registerServices(),await K.initialize(),await c.initializeAll(),a.emit("services:initialized");const e=document.getElementById("desktop-container");if(!e)throw new Error("Desktop container element not found");this.desktop=new _(e),await this.desktop.mount(),c.get(h.THEME_SERVICE).setTheme(this.config.theme),c.get(h.DESKTOP_SERVICE).setOSStyle(this.config.osStyle),this.initialized=!0,console.log("VFS Desktop initialized successfully"),a.emit("desktop:initialized",this)}catch(e){throw console.error("Failed to initialize VFS Desktop:",e),e}}registerServices(){c.register(h.WINDOW_MANAGER,z),c.register(h.DESKTOP_SERVICE,W),c.register(h.AUTH_SERVICE,M),c.register(h.THEME_SERVICE,D),c.register(h.COMPONENT_LOADER,I),c.register(h.USER_CONFIG_SERVICE,P),console.log("Core services registered")}async destroy(){if(this.initialized)try{console.log("Destroying VFS Desktop..."),this.desktop&&(await this.desktop.unmount(),this.desktop=void 0),await c.destroyAll(),a.removeAllListeners(),this.initialized=!1,console.log("VFS Desktop destroyed successfully")}catch(e){throw console.error("Error destroying VFS Desktop:",e),e}}getConfig(){return this.config}isInitialized(){return this.initialized}}async function X(){document.readyState==="loading"&&await new Promise(e=>{document.addEventListener("DOMContentLoaded",e,{once:!0})});const d=new Y;window.vfsDesktop=d;try{await d.initialize()}catch(e){console.error("Failed to initialize desktop:",e);const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ef4444;
      color: white;
      padding: 5px;
      border-radius: 8px;
      font-family: system-ui, sans-serif;
      z-index: 10000;
    `,t.textContent=`Failed to initialize VFS Desktop: ${e instanceof Error?e.message:"Unknown error"}`,document.body.appendChild(t)}}X().catch(console.error);export{R as B,h as S,p as _,a as e,c as s};
//# sourceMappingURL=main-888e55a8.js.map
